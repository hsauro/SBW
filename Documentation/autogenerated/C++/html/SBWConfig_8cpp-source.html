<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SBWConfig.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>SBWConfig.cpp</h1><a href="SBWConfig_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00052 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00053 <font class="preprocessor">#include "<a class="code" href="stdafx_8h.html">stdafx.h</a>"</font>
00054 <font class="preprocessor">#include "<a class="code" href="SBWConfig_8h.html">SBWConfig.h</a>"</font>
00055 <font class="preprocessor">#include "<a class="code" href="SBWRawException_8h.html">SBWRawException.h</a>"</font>
00056 <font class="preprocessor">#include "<a class="code" href="SBWCommunicationException_8h.html">SBWCommunicationException.h</a>"</font>
00057 
00058 <font class="preprocessor">#ifdef WIN32</font>
00059 <font class="preprocessor"></font><font class="preprocessor">#include "winsock2.h"</font>
00060 <font class="preprocessor">#include "TCHAR.h"</font>
00061 <font class="preprocessor">#endif</font>
00062 <font class="preprocessor"></font>
00063 <font class="preprocessor">#ifdef HAVE_UNISTD_H</font>
00064 <font class="preprocessor"></font><font class="preprocessor">#include &lt;unistd.h&gt;</font>
00065 <font class="preprocessor">#endif</font>
00066 <font class="preprocessor"></font>
00067 <font class="preprocessor">#ifdef HAVE_NETDB_H</font>
00068 <font class="preprocessor"></font><font class="preprocessor">#include &lt;netdb.h&gt;</font>
00069 <font class="preprocessor">#endif</font>
00070 <font class="preprocessor"></font>
00071 <font class="preprocessor">#ifdef LINUX</font>
00072 <font class="preprocessor"></font><font class="preprocessor">#include &lt;linux/limits.h&gt;</font>
<a name="l00073"></a><a class="code" href="SBWConfig_8cpp.html#a0">00073</a> <font class="preprocessor">#define MAX_PATH PATH_MAX</font>
00074 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00075 <font class="preprocessor"></font>
<a name="l00076"></a><a class="code" href="SBWConfig_8cpp.html#a1">00076</a> <font class="preprocessor">#define SBW_PROPERTIES_FILE "config.properties"</font>
<a name="l00077"></a><a class="code" href="SBWConfig_8cpp.html#a2">00077</a> <font class="preprocessor"></font><font class="preprocessor">#define SBW_HOME_FIELD "sbw.home="</font>
00078 <font class="preprocessor"></font>
00079 <font class="keyword">using</font> <font class="keyword">namespace </font>SystemsBiologyWorkbench;
00080 
<a name="l00105"></a><a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d0">00105</a> std::string Config::getSBWHome()
00106 {
00107     <font class="keyword">static</font> std::string sbwHome;
00108     <font class="keyword">const</font> <font class="keywordtype">char</font> *envVal = getenv(<font class="stringliteral">"SBW_HOME"</font>);
00109 
00110     <font class="comment">// The 1st time this is called, this computes the value.  Subsequent</font>
00111     <font class="comment">// calls return a cached value.</font>
00112 
00113     <font class="keywordflow">if</font> (! sbwHome.empty())
00114     {
00115         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Previously determined SBW home to be "</font> &lt;&lt; sbwHome);
00116         <font class="keywordflow">return</font> sbwHome;
00117     }
00118 
00119     <font class="keywordflow">if</font> (envVal != NULL)
00120     {
00121         <font class="comment">// Environment variable set.  This overrides anything else.</font>
00122         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Environment variable SBW_HOME = '"</font> &lt;&lt; envVal &lt;&lt; <font class="stringliteral">"'"</font>);
00123         sbwHome = envVal;
00124         <font class="keywordflow">return</font> sbwHome;
00125     }
00126     <font class="keywordflow">else</font>
00127     {
00128         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Environment variable SBW_HOME not set"</font>);
00129         <font class="keywordtype">bool</font> haveRegistryKey = <font class="keyword">false</font>;
00130 
00131 <font class="preprocessor">#ifdef WIN32</font>
00132 <font class="preprocessor"></font>        <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Trying to look up Windows registry entry for SBW"</font>);
00133 
00134         HKEY hKey;
00135         <font class="keyword">const</font> <font class="keywordtype">char</font> *regKey = <font class="stringliteral">"Software\\Systems Biology Workbench\\SBW Core"</font>;
00136         <font class="keyword">const</font> <font class="keywordtype">char</font> *item = <font class="stringliteral">"Directory"</font>;
00137 
00138         <font class="keywordflow">if</font> (ERROR_SUCCESS == RegOpenKeyEx(HKEY_LOCAL_MACHINE, regKey,
00139                                           0, KEY_READ, &amp;hKey))
00140         {
00141             DWORD dwType = REG_SZ;
00142             DWORD dwSize = 512;
00143             BYTE arRegData[512];
00144 
00145             <font class="keywordflow">if</font> (ERROR_SUCCESS == RegQueryValueEx(hKey, item, NULL, &amp;dwType,
00146                                                  arRegData, &amp;dwSize)
00147                 &amp;&amp; dwType == REG_SZ)
00148             {
00149                 haveRegistryKey = <font class="keyword">true</font>;
00150                 <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Found registry entry: '"</font> &lt;&lt; (LPCTSTR) arRegData &lt;&lt; <font class="stringliteral">"'"</font>);
00151                 sbwHome = (LPCTSTR) arRegData;
00152                 <font class="keywordflow">return</font> sbwHome;
00153             }
00154             RegCloseKey(hKey);
00155             hKey = NULL;
00156         }
00157 <font class="preprocessor">#endif</font>
00158 <font class="preprocessor"></font>
00159         <font class="keywordflow">if</font> (!haveRegistryKey)       <font class="comment">// Not Windows, or have no registry key.</font>
00160         {
00161 <font class="preprocessor">#ifdef WIN32</font>
00162 <font class="preprocessor"></font>            <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Could not find SBW registry entry in Windows registry"</font>);
00163 <font class="preprocessor">#endif</font>
00164 <font class="preprocessor"></font>            <font class="comment">// Try to read the config.properties file from the ~/.sbw dir.</font>
00165 
00166             std::string userDir = <a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d1">getSBWUserDir</a>();
00167             <font class="keywordflow">if</font> (! userDir.empty())
00168             {
00169                 <a class="code" href="portableOS_8h.html#a2">TRACE</a>(userDir &lt;&lt; <font class="stringliteral">" exists"</font>);
00170                 sbwHome = readSBWHomeFromPropFile(userDir);
00171             }
00172 
00173             <font class="keywordflow">if</font> (! sbwHome.empty())
00174                 <font class="keywordflow">return</font> sbwHome;
00175             <font class="keywordflow">else</font>
00176             {
00177 <font class="preprocessor">#ifdef WIN32</font>
00178 <font class="preprocessor"></font>                <font class="comment">// Last-ditch effort under Windows: try to find the</font>
00179                 <font class="comment">// config.properties file in the Windows system directory.</font>
00180 
00181                 <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Could not find user's .sbw directory"</font>);
00182 
00183                 std::string sysDir = getWindowsSystemDirectory();
00184                 <font class="keywordflow">if</font> (! sysDir.empty())
00185                 {
00186                     <a class="code" href="portableOS_8h.html#a2">TRACE</a>(sysDir &lt;&lt; <font class="stringliteral">" exists"</font>);
00187                     sbwHome = readSBWHomeFromPropFile(sysDir);
00188                 }
00189 
00190                 <font class="keywordflow">if</font> (! sbwHome.empty())
00191                     <font class="keywordflow">return</font> sbwHome;
00192                 <font class="keywordflow">else</font>
00193                 {
00194                     <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Could not find config.properties file; giving up."</font>);
00195 
00196                     std::string details(<font class="stringliteral">"Registry Key "</font>);
00197 
00198                     details += regKey;
00199                     details += <font class="charliteral">'\\'</font>;
00200                     details += item;
00201 
00202                     <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWRawException(
00203                         <font class="stringliteral">"SBW_HOME not set and SBW registry key not found."</font>
00204                         <font class="stringliteral">" This indicates that the SBW installation is"</font>
00205                         <font class="stringliteral">" corrupted.  You may be able to fix the installation"</font>
00206                         <font class="stringliteral">" by setting the environment variable SBW_HOME"</font>
00207                         <font class="stringliteral">" to the path to the parent of the folder containing"</font>
00208                         <font class="stringliteral">" the file SBWBroker.jar."</font>,
00209                         details.c_str());
00210 <font class="preprocessor">#else</font>
00211 <font class="preprocessor"></font>                    <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWCommunicationException(
00212                         <font class="stringliteral">"Could not find ~/.sbw/config.properties and"</font>
00213                         <font class="stringliteral">" therefore could not determine SBW home directory"</font>,
00214                         <font class="stringliteral">"Could not find ~/.sbw/config.properties and"</font>
00215                         <font class="stringliteral">" therefore could not determine SBW home directory."</font>
00216                         <font class="stringliteral">" This indicates that the SBW installation is"</font>
00217                         <font class="stringliteral">" corrupted.  You may be able to fix the installation"</font>
00218                         <font class="stringliteral">" by setting the environment variable SBW_HOME"</font>
00219                         <font class="stringliteral">" to the path to the parent of the folder containing"</font>
00220                         <font class="stringliteral">" the file SBWBroker.jar."</font>);
00221 <font class="preprocessor">#endif</font>
00222 <font class="preprocessor"></font><font class="preprocessor">#ifdef WIN32</font>
00223 <font class="preprocessor"></font>                }
00224 <font class="preprocessor">#endif</font>
00225 <font class="preprocessor"></font>            }
00226         }
00227 
00228         <font class="comment">// If we get here, we've failed to find the value anywhere.</font>
00229 
00230         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Could not determine SBW home directory"</font>);
00231         <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWCommunicationException(
00232             <font class="stringliteral">"SBW could not find the SBW home directory"</font>
00233             <font class="stringliteral">"Multiple attempts to determine the SBW home directory"</font>
00234             <font class="stringliteral">" have failed.  This indicates that the SBW installation is"</font>
00235             <font class="stringliteral">" corrupted.  You may be able to fix the installation"</font>
00236             <font class="stringliteral">" by setting the environment variable SBW_HOME"</font>
00237             <font class="stringliteral">" to the path to the parent of the folder containing"</font>
00238             <font class="stringliteral">" the file SBWBroker.jar."</font>);
00239     }
00240 }
00241 
<a name="l00251"></a><a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d2">00251</a> std::string Config::getLibDirectory()
00252 {
00253     std::string path = Config::getSBWHome();
00254     <font class="keywordflow">if</font> (! path.empty())
00255     {
00256         path += SBWOS::DirectorySeparator();
00257         path += <font class="stringliteral">"lib"</font>;
00258         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Using SBW lib directory = '"</font> &lt;&lt; path &lt;&lt; <font class="stringliteral">"'"</font>);
00259         <font class="keywordflow">return</font> path;
00260     }
00261     <font class="keywordflow">else</font>
00262     {
00263         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Can't find SBW lib directory because can't"</font>
00264               <font class="stringliteral">" determine the SBW home directory"</font>);
00265         <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWCommunicationException(
00266             <font class="stringliteral">"Cannot locate the SBW installation directory"</font>,
00267             <font class="stringliteral">"The SBW installation is corrupted.  You"</font>
00268             <font class="stringliteral">" may be able to fix the installation by"</font>
00269             <font class="stringliteral">" setting the environment variable SBW_HOME"</font>
00270             <font class="stringliteral">" to the parent of the folder containing the"</font>
00271             <font class="stringliteral">" file SBWBroker.jar."</font>);
00272     }
00273 }
00274 
00275 
00276 <font class="preprocessor">#ifdef WIN32</font>
00277 <font class="preprocessor"></font><font class="keyword">typedef</font> BOOL (STDMETHODCALLTYPE FAR * LPFNGETUSERPROFILEDIR) (
00278   HANDLE hToken,
00279   LPTSTR lpProfileDir,
00280   LPDWORD lpcchSize
00281 );
00282 <font class="preprocessor">#endif</font>
00283 <font class="preprocessor"></font>
<a name="l00300"></a><a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d1">00300</a> std::string Config::getSBWUserDir()
00301 {
00302     <font class="keyword">static</font> std::string userDir;
00303 
00304     <font class="keywordflow">if</font> (! userDir.empty())
00305     {
00306         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Previously determined SBW user dir to be "</font> &lt;&lt; userDir);
00307         <font class="keywordflow">return</font> userDir;
00308     }
00309 
00310 <font class="preprocessor">#ifdef WIN32</font>
00311 <font class="preprocessor"></font>    OSVERSIONINFO osVersionInfo ;
00312 
00313     osVersionInfo.dwOSVersionInfoSize = <font class="keyword">sizeof</font>(OSVERSIONINFO) ;
00314 
00315     <font class="keywordflow">if</font> (!GetVersionEx(&amp;osVersionInfo))
00316         SBWOS::ThrowError();
00317 
00318     <font class="keywordflow">if</font> (osVersionInfo.dwPlatformId == VER_PLATFORM_WIN32_NT) 
00319     {
00320         <font class="comment">// NT, 2000 and XP</font>
00321 
00322         HMODULE  hUserEnvLib = NULL;
00323 
00324         hUserEnvLib = LoadLibrary( _T(<font class="stringliteral">"userenv.dll"</font>) );
00325         <font class="keywordflow">if</font> ( !hUserEnvLib )
00326             SBWOS::ThrowError();
00327 
00328         LPFNGETUSERPROFILEDIR GetUserProfileDirectory = NULL;
00329 
00330 <font class="preprocessor">#ifdef UNICODE</font>
00331 <font class="preprocessor"></font>        GetUserProfileDirectory =
00332             (LPFNGETUSERPROFILEDIR) GetProcAddress(
00333                 hUserEnvLib, <font class="stringliteral">"GetUserProfileDirectoryW"</font> );
00334 <font class="preprocessor">#else</font>
00335 <font class="preprocessor"></font>        GetUserProfileDirectory =
00336             (LPFNGETUSERPROFILEDIR) GetProcAddress(
00337                 hUserEnvLib, <font class="stringliteral">"GetUserProfileDirectoryA"</font> );
00338 <font class="preprocessor">#endif</font>
00339 <font class="preprocessor"></font>
00340         <font class="keywordflow">if</font> (!GetUserProfileDirectory)
00341             SBWOS::ThrowError();
00342 
00343         HANDLE hUserToken;
00344 
00345         <font class="keywordflow">if</font> (!OpenProcessToken(GetCurrentProcess(), TOKEN_QUERY, &amp;hUserToken))
00346             SBWOS::ThrowError();
00347 
00348         TCHAR buffer[<a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + 1];
00349         DWORD size = <a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + 1;
00350 
00351         <font class="keywordflow">if</font> (!GetUserProfileDirectory(hUserToken, buffer, &amp;size))
00352             SBWOS::ThrowError();
00353 
00354         <font class="comment">// Release USERENV.DLL</font>
00355         FreeLibrary( hUserEnvLib );
00356 
00357         userDir = buffer ;
00358     }
00359     <font class="keywordflow">else</font>
00360     {
00361         <font class="comment">// 95, 98 &amp; ME</font>
00362         TCHAR buffer[<a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + 1];
00363 
00364         <font class="keywordflow">if</font> (!GetWindowsDirectory(buffer, <a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + 1))
00365             SBWOS::ThrowError();
00366 
00367         userDir = buffer ;
00368     }
00369 
00370 <font class="preprocessor">#else // UNIX</font>
00371 <font class="preprocessor"></font>    <font class="keyword">const</font> <font class="keywordtype">char</font> *envVal = getenv(<font class="stringliteral">"HOME"</font>);
00372 
00373     <font class="keywordflow">if</font> (envVal == NULL)         <font class="comment">// Environment variable not set.</font>
00374     {
00375         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Environment variable HOME not set -- can't find user home dir"</font>);
00376         <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWCommunicationException(
00377             <font class="stringliteral">"User environment variable HOME is not set"</font>);
00378     }
00379     <font class="keywordflow">else</font>                                <font class="comment">// Environment variable set.</font>
00380     {
00381         userDir = envVal;
00382     }
00383 
00384 <font class="preprocessor">#endif</font>
00385 <font class="preprocessor"></font>        
00386     userDir += SBWOS::DirectorySeparator();
00387     userDir += <font class="stringliteral">".sbw"</font>;
00388 
00389     <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Using user directory = '"</font> &lt;&lt; userDir &lt;&lt; <font class="stringliteral">"'"</font>);
00390     <font class="keywordflow">return</font> userDir;
00391 }
00392 
<a name="l00407"></a><a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d3">00407</a> std::string Config::getRuntimeFilesDirectory()
00408 {
00409     <font class="keyword">static</font> std::string runtimeDir;
00410 
00411     <font class="keywordflow">if</font> (! runtimeDir.empty())
00412     {
00413         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Previously determined runtime files dir to be "</font> &lt;&lt; runtimeDir);
00414         <font class="keywordflow">return</font> runtimeDir;
00415     }
00416 
00417     <font class="keywordtype">char</font> shortname[256];
00418     <font class="keywordflow">if</font> (gethostname(shortname, 255) &lt; 0)
00419         <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWCommunicationException(<font class="stringliteral">"Cannot determine host name"</font>);
00420 
00421     <font class="keyword">struct </font>hostent *host = gethostbyname(shortname);
00422     <font class="keywordflow">if</font> (host == NULL)
00423         <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWCommunicationException(
00424             <font class="stringliteral">"Cannot determine local host's network address"</font>);
00425     <font class="keywordflow">else</font>
00426     {
00427         <font class="keywordtype">char</font> tmp[<font class="keyword">sizeof</font> <font class="stringliteral">"255.255.255.255"</font>];
00428         <font class="keywordtype">char</font> *a = host-&gt;h_addr_list[0];
00429         sprintf(tmp, <font class="stringliteral">"%u.%u.%u.%u"</font>, (u_char) a[0], (u_char) a[1],
00430                 (u_char) a[2], (u_char) a[3]);
00431 
00432         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Local host address is "</font> &lt;&lt; tmp);
00433 
00434         runtimeDir = <a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d1">getSBWUserDir</a>();
00435         runtimeDir += SBWOS::DirectorySeparator();
00436         runtimeDir += <font class="stringliteral">"runtime"</font>;
00437         runtimeDir += SBWOS::DirectorySeparator();
00438         runtimeDir += tmp;
00439 
00440         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Runtime files directory = '"</font> &lt;&lt; runtimeDir &lt;&lt; <font class="stringliteral">"'"</font>);
00441         <font class="keywordflow">return</font> runtimeDir;
00442     }
00443 }
00444 
<a name="l00452"></a><a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d4">00452</a> std::string Config::getSessionKeyFile()
00453 {
00454     std::string file = <a class="code" href="classSystemsBiologyWorkbench_1_1Config.html#d3">getRuntimeFilesDirectory</a>();
00455     file += SBWOS::DirectorySeparator();
00456     file += <font class="stringliteral">"key"</font>;
00457     <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Using session key file = '"</font> &lt;&lt; file &lt;&lt; <font class="stringliteral">"'"</font>);
00458     <font class="keywordflow">return</font> file;
00459 }
00460 
00461 <font class="preprocessor">#ifdef WIN32</font>
00462 <font class="preprocessor"></font>
00470 std::string Config::getWindowsSystemDirectory()
00471 {
00472     <font class="keywordtype">char</font> *dir;    
00473     WIN32_FIND_DATA fd;
00474 
00475     GetSystemDirectory(dir, <a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a>);
00476     FindFirstFile(dir, &amp;fd);
00477     strcpy(strrchr(dir, <font class="charliteral">'\\'</font>) + 1, fd.cFileName);
00478     std::string sysDir(dir);
00479 
00480     <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"The Windows system directory appears to be "</font> &lt;&lt; sysDir);
00481     <font class="keywordflow">return</font> sysDir;
00482 }
00483 <font class="preprocessor">#endif</font>
00484 <font class="preprocessor"></font>
00489 std::string Config::readSBWHomeFromPropFile(std::string dir)
00490 {
00491     std::string file = dir;
00492     file += SBWOS::DirectorySeparator();
00493     file += <a class="code" href="SBWConfig_8cpp.html#a1">SBW_PROPERTIES_FILE</a>;
00494 
00495     FILE *fp;
00496     <font class="keywordflow">if</font> ((fp = fopen(file.c_str(), <font class="stringliteral">"r"</font>)) != NULL)
00497     {
00498         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Reading sbw.home from "</font> &lt;&lt; file);
00499 
00500         size_t taglength = strlen(<a class="code" href="SBWConfig_8cpp.html#a2">SBW_HOME_FIELD</a>);
00501         <font class="keywordtype">char</font> line[<a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a>];
00502 
00503         <font class="keywordflow">while</font> (! feof(fp) &amp;&amp; (fgets(line, <a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a>, fp) != NULL))
00504             <font class="keywordflow">if</font> (strncmp(line, <a class="code" href="SBWConfig_8cpp.html#a2">SBW_HOME_FIELD</a>, taglength) == 0)
00505             {
00506                 <font class="keywordtype">char</font> *newline = strchr(line, <font class="charliteral">'\n'</font>);
00507                 size_t end = newline - line;
00508 
00509                 <font class="keywordflow">if</font> ((size_t)(line + taglength) != end)
00510                 {                           
00511                     <font class="keywordtype">char</font> buf[<a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a>];
00512                     strncpy(buf, line + taglength, end - taglength);
00513                     buf[end - taglength] = (char)NULL;
00514                     fclose(fp);
00515                     std::string sbwHome(buf);
00516                     <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"sbw.home = "</font> &lt;&lt; sbwHome);
00517                     <font class="keywordflow">return</font> sbwHome;
00518                 }
00519                 <font class="keywordflow">else</font>
00520                 {
00521                     fclose(fp);
00522                     <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Value of sbw.home in config.properties is empty"</font>);
00523                     <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWRawException(
00524                         <font class="stringliteral">"Empty sbw.home entry in config.properties file"</font>,
00525                         <font class="stringliteral">"config.properties file exists but contains an empty"</font>
00526                         <font class="stringliteral">" value for sbw.home. This indicates that the SBW"</font>
00527                         <font class="stringliteral">" installation is corrupted.  You may be able to fix"</font>
00528                         <font class="stringliteral">" the installation by setting the environment variable"</font>
00529                         <font class="stringliteral">" SBW_HOME to the path to the parent of the folder"</font>
00530                         <font class="stringliteral">" containing the file SBWBroker.jar."</font>);
00531                 }
00532             }
00533 
00534         fclose(fp);
00535         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"No sbw.home entry in config.properties file"</font>);
00536         <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWRawException(
00537             <font class="stringliteral">"No sbw.home entry in config.properties file"</font>,
00538             <font class="stringliteral">"config.properties file exists but does not contain a"</font>
00539             <font class="stringliteral">" value for sbw.home. This indicates that the SBW"</font>
00540             <font class="stringliteral">" installation is corrupted.  You may be able to fix"</font>
00541             <font class="stringliteral">" the installation by setting the environment variable"</font>
00542             <font class="stringliteral">" SBW_HOME to the path to the parent of the folder"</font>
00543             <font class="stringliteral">" containing the file SBWBroker.jar."</font>);
00544     }
00545     <font class="keywordflow">else</font>
00546         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Unable to open "</font> &lt;&lt; file.c_str());
00547 
00548     <font class="keywordflow">return</font> NULL;
00549 }
</pre></div><hr>
<br>
<address>
<center>
<b>Systems Biology Workbench Development Group</b><br>
ERATO Kitano Systems Biology Project<br>
Control and Dynamical Systems, MC 107-81<br>
California Institute of Technology, Pasadena, CA 91125, USA<br>
<A HREF="mailto:sysbio-team@caltech.edu">sysbio-team@caltech.edu</A><br>
<A HREF="http://www.cds.caltech.edu/erato">http://www.cds.caltech.edu/erato</A><br><br>
<small>
Generated on Fri Nov 22 00:10:05 2002 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.2.14
</small>
</center>
</address>
</body>
</html>
