<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ModuleImpl.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ModuleImpl.cpp</h1><a href="ModuleImpl_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00013 <font class="comment">/*</font>
00014 <font class="comment">** Copyright 2001 California Institute of Technology and</font>
00015 <font class="comment">** Japan Science and Technology Corporation.</font>
00016 <font class="comment">** </font>
00017 <font class="comment">** This library is free software; you can redistribute it and/or modify it</font>
00018 <font class="comment">** under the terms of the GNU Lesser General Public License as published</font>
00019 <font class="comment">** by the Free Software Foundation; either version 2.1 of the License, or</font>
00020 <font class="comment">** any later version.</font>
00021 <font class="comment">** </font>
00022 <font class="comment">** This library is distributed in the hope that it will be useful, but</font>
00023 <font class="comment">** WITHOUT ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF</font>
00024 <font class="comment">** MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  The software and</font>
00025 <font class="comment">** documentation provided hereunder is on an "as is" basis, and the</font>
00026 <font class="comment">** California Institute of Technology and Japan Science and Technology</font>
00027 <font class="comment">** Corporation have no obligations to provide maintenance, support,</font>
00028 <font class="comment">** updates, enhancements or modifications.  In no event shall the</font>
00029 <font class="comment">** California Institute of Technology or the Japan Science and Technology</font>
00030 <font class="comment">** Corporation be liable to any party for direct, indirect, special,</font>
00031 <font class="comment">** incidental or consequential damages, including lost profits, arising</font>
00032 <font class="comment">** out of the use of this software and its documentation, even if the</font>
00033 <font class="comment">** California Institute of Technology and/or Japan Science and Technology</font>
00034 <font class="comment">** Corporation have been advised of the possibility of such damage.  See</font>
00035 <font class="comment">** the GNU Lesser General Public License for more details.</font>
00036 <font class="comment">** </font>
00037 <font class="comment">** You should have received a copy of the GNU Lesser General Public License</font>
00038 <font class="comment">** along with this library; if not, write to the Free Software Foundation,</font>
00039 <font class="comment">** Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.</font>
00040 <font class="comment">**</font>
00041 <font class="comment">** The original code contained here was initially developed by:</font>
00042 <font class="comment">**</font>
00043 <font class="comment">**     Andrew Finney, Herbert Sauro, Michael Hucka, Hamid Bolouri</font>
00044 <font class="comment">**     The Systems Biology Workbench Development Group</font>
00045 <font class="comment">**     ERATO Kitano Systems Biology Project</font>
00046 <font class="comment">**     Control and Dynamical Systems, MC 107-81</font>
00047 <font class="comment">**     California Institute of Technology</font>
00048 <font class="comment">**     Pasadena, CA, 91125, USA</font>
00049 <font class="comment">**</font>
00050 <font class="comment">**     http://www.cds.caltech.edu/erato</font>
00051 <font class="comment">**     mailto:sysbio-team@caltech.edu</font>
00052 <font class="comment">**</font>
00053 <font class="comment">** Contributor(s):</font>
00054 <font class="comment">**</font>
00055 <font class="comment">*/</font>
00056 
00057 <font class="comment">// ModuleImpl.cpp: implementation of the ModuleImpl class.</font>
00058 <font class="comment">//</font>
00060 <font class="comment"></font>
00061 <font class="preprocessor">#include &lt;string.h&gt;</font>
00062 <font class="preprocessor">#include &lt;iostream&gt;</font>
00063 <font class="preprocessor">#include "<a class="code" href="stdafx_8h.html">stdafx.h</a>"</font>
00064 <font class="preprocessor">#include "<a class="code" href="ModuleImpl_8h.html">ModuleImpl.h</a>"</font>
00065 
00066 <font class="preprocessor">#include "<a class="code" href="SBWLowLevel_8h.html">SBWLowLevel.h</a>"</font>
00067 <font class="preprocessor">#include "<a class="code" href="ServiceImpl_8h.html">ServiceImpl.h</a>"</font>
00068 <font class="preprocessor">#include "<a class="code" href="DoNothingReceiver_8h.html">DoNothingReceiver.h</a>"</font>
00069 <font class="preprocessor">#include "<a class="code" href="SBWServiceNotFoundException_8h.html">SBWServiceNotFoundException.h</a>"</font>
00070 <font class="preprocessor">#include "<a class="code" href="SBWMethodNotFoundException_8h.html">SBWMethodNotFoundException.h</a>"</font>
00071 <font class="preprocessor">#include "<a class="code" href="MethodImpl_8h.html">MethodImpl.h</a>"</font>
00072 <font class="preprocessor">#include "<a class="code" href="MethodInline_8h.html">MethodInline.h</a>"</font>
00073 <font class="preprocessor">#include "<a class="code" href="SBWApplicationException_8h.html">SBWApplicationException.h</a>"</font>
00074 <font class="preprocessor">#include "<a class="code" href="MethodTable_8h.html">MethodTable.h</a>"</font>
00075 
00076 <font class="preprocessor">#ifdef LINUX</font>
00077 <font class="preprocessor"></font><font class="preprocessor">#include &lt;unistd.h&gt;</font>
00078 <font class="preprocessor">#include &lt;linux/limits.h&gt;</font>
00079 <font class="preprocessor">#endif</font>
00080 <font class="preprocessor"></font>
00081 <font class="keyword">using</font> <font class="keyword">namespace </font>SystemsBiologyWorkbench ;
00082 
00084 <font class="comment">// Construction/Destruction</font>
00086 <font class="comment"></font>
<a name="l00090"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a1">00090</a> <font class="comment"></font>ModuleImpl::~ModuleImpl()
00091 {
00092         <font class="keywordflow">if</font> (commandLine != NULL)
00093                 free(commandLine);
00094 
00095         free(uniqueName);
00096         free(displayName);
00097         free(help);
00098 
00099         std::vector&lt;ServiceImpl *&gt;::iterator itr= services.begin();
00100 
00101         <font class="keywordflow">while</font> (itr != services.end())
00102         {
00103                 <font class="keyword">delete</font> *itr ;
00104                 itr++ ;
00105         }
00106 
00107         <font class="keywordflow">if</font> (mode == <a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a38">ModuleMode</a>)
00108                 SBWLowLevel::setReceiver(<font class="keyword">new</font> DoNothingReceiver());
00109 }
00110 
<a name="l00112"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a9">00112</a> <font class="keywordtype">void</font> ModuleImpl::waitForDisconnect()
00113 {
00114         SBWLowLevel::waitForDisconnect();
00115 }
00116 
<a name="l00124"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a0">00124</a> ModuleImpl::ModuleImpl(std::string un, std::string dn, <a class="code" href="namespaceSystemsBiologyWorkbench.html#a9">ModuleManagementType</a> t, std::string h)
00125 : uniqueName(strdup(un.c_str())),
00126         displayName(strdup(dn.c_str())),
00127         type(t),
00128         commandLine(NULL),
00129         help(strdup(h.c_str())),
00130         mode(<a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a37">NormalMode</a>)
00131 {
00132 }
00133 
<a name="l00138"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a2">00138</a> <font class="keywordtype">void</font> ModuleImpl::setCommandLine(std::string cmd)
00139 {
00140         commandLine = strdup(cmd.c_str());
00141 }
00142 
<a name="l00150"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a3">00150</a> <font class="keywordtype">void</font> ModuleImpl::addService(
00151         std::string serviceName, std::string serviceDisplayName, std::string category, std::string help)
00152 {
00153         services.push_back(<font class="keyword">new</font> ServiceImpl(serviceName, serviceDisplayName, category, help));
00154 }
00155 
<a name="l00161"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a5">00161</a> <font class="keywordtype">void</font> ModuleImpl::enableModuleServices()
00162 {
00163         mode = <a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a38">ModuleMode</a> ;
00164 
00165         <font class="comment">// TODO review how this connect stuff works</font>
00166         <font class="comment">// needs to be more flexiable</font>
00167         <font class="comment">// if aleady connected change module name!</font>
00168 
00169         <font class="comment">// changed the order of the following functions - AMF 7th Aug 02</font>
00170         SBWLowLevel::setReceiver(<font class="keyword">this</font>);
00171         SBWLowLevel::connect(uniqueName);
00172 }
00173 
<a name="l00177"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a6">00177</a> <font class="keywordtype">void</font> ModuleImpl::registerModule()
00178 {
00179         mode = <a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a39">RegisterMode</a> ;
00180 
00181         <font class="keywordflow">if</font> (!SBWLowLevel::isConnected())
00182                 SBWLowLevel::connect();
00183 
00184         <font class="keywordflow">if</font> (commandLine == NULL)
00185                 <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWApplicationException(<font class="stringliteral">"command line not set on call to register module"</font>);
00186 
00187         SBWLowLevel::getBrokerMethod(
00188                 <font class="stringliteral">"void registerModule(string,string,int,string, string)"</font>).call(
00189                         DataBlockWriter() &lt;&lt; (<font class="keywordtype">char</font> *)uniqueName &lt;&lt; displayName &lt;&lt; (<font class="keywordtype">int</font>)type &lt;&lt; commandLine &lt;&lt; help);
00190 
00191         std::vector&lt;ServiceImpl *&gt;::iterator itr = services.begin();
00192         ServiceMethod registerService =
00193                 SBWLowLevel::getBrokerMethod(
00194                         <font class="stringliteral">"void registerService(string,string,string,string, string)"</font>);
00195 
00196         <font class="keywordflow">while</font> (itr != services.end())
00197         {
00198                 ServiceImpl *service = *itr ;
00199                 registerService.call(
00200                         DataBlockWriter() &lt;&lt;
00201                                 uniqueName &lt;&lt;
00202                                 service-&gt;getName() &lt;&lt;
00203                                 service-&gt;getDisplayName() &lt;&lt;
00204                                 service-&gt;getCategory() &lt;&lt;
00205                                 service-&gt;getHelp()); 
00206 
00207                 itr++ ;
00208         }
00209 }
00210 
00216 ServiceImpl *ModuleImpl::getService(std::string serviceName)
00217 {
00218         std::vector&lt;ServiceImpl *&gt;::iterator itr = services.begin();
00219 
00220         <font class="keywordflow">while</font> (itr != services.end())
00221         {
00222                 <font class="keywordflow">if</font> ((*itr)-&gt;getName().compare(serviceName) == 0)
00223                         <font class="keywordflow">return</font> *itr ;
00224 
00225                 itr++ ;
00226         }
00227 
00228         std::string message(<font class="stringliteral">"service "</font>);
00229 
00230         message += serviceName ;
00231         message += <font class="stringliteral">" not found"</font>;
00232         <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWServiceNotFoundException(message);
00233 }
00234 
<a name="l00243"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a7">00243</a> <font class="keywordtype">void</font> ModuleImpl::setHandler(
00244         std::string serviceName, Handler *handler, std::string signature, <font class="keywordtype">bool</font> synchronized, std::string help)
00245 {
00246         getService(serviceName)-&gt;addMethod(handler, signature, synchronized, help);
00247 }
00248 
<a name="l00254"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a8">00254</a> Handler *ModuleImpl::getHandler(std::string serviceName, std::string methodSignature)
00255 {
00256         <font class="keywordflow">return</font> getService(serviceName)-&gt;getHandler(methodSignature);
00257 }
00258 
00264 ServiceImpl *ModuleImpl::getService(<a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> queryServiceId)
00265 {
00266         <font class="keywordflow">if</font> (queryServiceId &gt;= 0 &amp;&amp; queryServiceId &lt; (Integer) services.size())
00267                 <font class="keywordflow">return</font> services[queryServiceId];
00268         <font class="keywordflow">else</font>
00269                 <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWServiceNotFoundException(<font class="stringliteral">"unknown service id"</font>);
00270 }
00271 
00281 DataBlockWriter ModuleImpl::receive(
00282                 <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> fromModuleId, <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> serviceId, <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> methodId, DataBlockReader args)
00283 {
00284         <font class="keywordflow">if</font> (serviceId == <a class="code" href="namespaceSystemsBiologyWorkbench.html#a63a47">SBWSystemService</a>)
00285         {
00286                 DataBlockWriter writer ;
00287 
00288                 <font class="keywordflow">switch</font> (methodId)
00289                 {
00290                         <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a65a51">SBWGetServicesMethod</a>:
00291                                 {
00292                                         std::vector&lt;std::string&gt; serviceNames(services.size());
00293                                         <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i = 0 ;
00294 
00295                                         <font class="keywordflow">while</font> (i != services.size())
00296                                         {
00297                                                 serviceNames[i] = services[i]-&gt;getName();
00298                                                 i++;
00299                                         }
00300 
00301                                         writer &lt;&lt; serviceNames ;
00302                                 }
00303                                 <font class="keywordflow">return</font> writer ;
00304 
00305                         <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a65a52">SBWGetMethodsMethod</a> :
00306                                 {
00307                                         <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> queryServiceId ;
00308 
00309                                         args &gt;&gt; queryServiceId ;
00310 
00311                                         getService(queryServiceId)-&gt;addSignatures(writer);
00312                                 }
00313                                 <font class="keywordflow">return</font> writer ;
00314 
00315                         <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a65a54">SBWShutdownMethod</a> :
00316                                 SBWLowLevel::signalDisconnect();
00317                                 <font class="keywordflow">return</font> writer ;
00318 
00319                         <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a65a55">SBWGetMethodHelpMethod</a> :
00320                                 {
00321                                         <font class="keywordtype">int</font> requestedServiceId, requestedMethodId ;
00322 
00323                                         args &gt;&gt; requestedServiceId &gt;&gt; requestedMethodId ;
00324                                         writer &lt;&lt; getService(requestedServiceId)-&gt;getMethod(requestedMethodId)-&gt;getHelp();
00325                                 }
00326                                 <font class="keywordflow">return</font> writer ;
00327 
00328                         <font class="keywordflow">default</font> : 
00329                                 <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWMethodNotFoundException(<font class="stringliteral">"method not found"</font>);
00330                 }
00331         }
00332         <font class="keywordflow">else</font> 
00333                 <font class="keywordflow">return</font> getService(serviceId)-&gt;getMethod(methodId)-&gt;invoke(Module(fromModuleId), args);  
00334 }
00335 
00340 <font class="keywordtype">bool</font> ModuleImpl::canDelete()
00341 {
00342         <font class="keywordflow">return</font> <font class="keyword">false</font> ;
00343 }
00344 
00351 <font class="keywordtype">void</font> ModuleImpl::run(<a class="code" href="namespaceSystemsBiologyWorkbench.html#a8">ModuleModeType</a> mode, <font class="keywordtype">bool</font> wait, <font class="keyword">const</font> <font class="keywordtype">char</font> *argZero)
00352 {
00353         <font class="keywordflow">switch</font> (mode)
00354         {
00355                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a39">RegisterMode</a>:
00356                         <font class="keywordflow">if</font> (commandLine == NULL)
00357                                 commandLine = <a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#d1">calculateCommandLineRaw</a>(argZero);
00358 
00359                         <a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a6">registerModule</a>();
00360                         SBWLowLevel::disconnect();
00361                         <font class="keywordflow">break</font>;
00362 
00363                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a38">ModuleMode</a>:
00364                         <a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a5">enableModuleServices</a>();
00365 
00366                         <font class="keywordflow">if</font> (wait)
00367                                 <a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a9">waitForDisconnect</a>();
00368                         <font class="keywordflow">break</font>;
00369 
00370                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a37">NormalMode</a>:
00371                     <font class="comment">/* We do nothing in this case. */</font>
00372                         <font class="keywordflow">break</font>;
00373         }
00374 }
00375 
<a name="l00406"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a10">00406</a> <font class="keywordtype">void</font> ModuleImpl::run(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>* argv[], <font class="keywordtype">bool</font> wait <font class="comment">/* = true */</font>)
00407 {
00408         <font class="keywordtype">int</font> i = 0;
00409         <font class="keywordtype">char</font> *argZero = argv[0];
00410         
00411         <font class="keywordflow">if</font> (SBWLowLevel::processArguments(argc, argv))
00412         {
00413                 <font class="keywordflow">while</font> (i != argc)
00414                 {
00415                         <font class="keywordflow">if</font> (strcmp(argv[i], <font class="stringliteral">"-sbwregister"</font>) == 0)
00416                                 <a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a10">run</a>(<a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a39">RegisterMode</a>, wait, argZero);
00417                         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(argv[i], <font class="stringliteral">"-sbwmodule"</font>) == 0)
00418                                 <a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#a10">run</a>(<a class="code" href="namespaceSystemsBiologyWorkbench.html#a61a38">ModuleMode</a>, wait, argZero);
00419 
00420                         i++;
00421                 }
00422         }
00423 }
00424 
<a name="l00430"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#d0">00430</a> std::string ModuleImpl::calculateCommandLine(std::string argZero)
00431 {
00432         <font class="keywordtype">char</font> *cmdLine = <a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#d1">calculateCommandLineRaw</a>(argZero.c_str());
00433         std::string result(cmdLine);
00434 
00435         <font class="keyword">delete</font>[] cmdLine ;
00436 
00437         <font class="keywordflow">return</font> result ;
00438 }
00439 
<a name="l00446"></a><a class="code" href="ModuleImpl_8cpp.html#a0">00446</a> <font class="keywordtype">char</font> *<a class="code" href="ModuleImpl_8cpp.html#a0">stripcr</a>(<font class="keywordtype">char</font> *s)
00447 {
00448     <font class="keywordtype">char</font> *ptr;
00449 
00450     <font class="keywordflow">for</font> (ptr = s; *ptr != <font class="charliteral">'\0'</font> &amp;&amp; *ptr != <font class="charliteral">'\n'</font>; ptr++)
00451         ;
00452     *ptr = <font class="charliteral">'\0'</font>;
00453 
00454     <font class="keywordflow">return</font> s;
00455 }
00456 
<a name="l00462"></a><a class="code" href="classSystemsBiologyWorkbench_1_1ModuleImpl.html#d1">00462</a> <font class="keywordtype">char</font> *ModuleImpl::calculateCommandLineRaw(<font class="keyword">const</font> <font class="keywordtype">char</font> *argZero)
00463 {
00464 <font class="preprocessor">#if defined(WIN32)</font>
00465 <font class="preprocessor"></font>
00466         <font class="keywordtype">char</font> *lpFilePart ;
00467         <font class="keyword">const</font> <font class="keywordtype">char</font> *format = <font class="stringliteral">"\"%s\" -sbwmodule"</font>;
00468         <font class="keywordtype">char</font> buffer[<a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + 1];
00469         <font class="keywordtype">char</font> *result = <font class="keyword">new</font> <font class="keywordtype">char</font>[<a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + strlen(format) - 1];
00470 
00471         <font class="comment">// First try to find it with the current extension.</font>
00472 
00473         <font class="keywordflow">if</font> (SearchPath(
00474                         NULL, <font class="comment">// indicates to search for exes</font>
00475                         argZero,  <font class="comment">// pointer to filename</font>
00476                         <font class="stringliteral">""</font>, <font class="comment">// pointer to extension</font>
00477                         <a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + 1, <font class="comment">// size, in characters, of buffer</font>
00478                         buffer,     <font class="comment">// pointer to buffer for found filename</font>
00479                         &amp;lpFilePart))   <font class="comment">// pointer to pointer to file component</font>
00480         {
00481                 sprintf(result, format, buffer);
00482                 <font class="keywordflow">return</font> result ;
00483         }
00484 
00485         <font class="comment">// runthro extensions on PATHEXT</font>
00486         <font class="keywordtype">char</font> *pathExt = getenv(<font class="stringliteral">"PATHEXT"</font>);
00487         <font class="keywordtype">char</font> *ext = strtok(pathExt, <font class="stringliteral">";"</font>);
00488 
00489         <font class="keywordflow">while</font> (ext != NULL)
00490         {
00491                 <font class="keywordflow">if</font> (SearchPath(
00492                                 NULL, <font class="comment">// indicates to search for exes</font>
00493                                 argZero,  <font class="comment">// pointer to filename</font>
00494                                 ext, <font class="comment">// pointer to extension</font>
00495                                 <a class="code" href="SBWConfig_8cpp.html#a0">MAX_PATH</a> + 1, <font class="comment">// size, in characters, of buffer</font>
00496                                 buffer,     <font class="comment">// pointer to buffer for found filename</font>
00497                                 &amp;lpFilePart))   <font class="comment">// pointer to pointer to file component</font>
00498                 {
00499                         sprintf(result, format, buffer);
00500                         <font class="keywordflow">return</font> result ;
00501                 }
00502 
00503                 ext = strtok(NULL, <font class="stringliteral">";"</font>);
00504         }
00505 
00506         SBWOS::ThrowError();
00507 
00508 <font class="preprocessor">#else</font>
00509 <font class="preprocessor"></font>
00510         <font class="keyword">const</font> <font class="keywordtype">char</font> *addedArg = <font class="stringliteral">"-sbwmodule"</font>;
00511         <font class="keywordtype">char</font> *result = <font class="keyword">new</font> <font class="keywordtype">char</font>[PATH_MAX];
00512         <font class="keywordtype">char</font> tmpwd[PATH_MAX];
00513 
00514         <font class="comment">// Arg zero may be a relative path or a full path.  If it's a relative</font>
00515         <font class="comment">// path, we have to prepend the current directory path.</font>
00516 
00517         <font class="keywordflow">if</font> (argZero != NULL &amp;&amp; argZero[0] != <font class="charliteral">'/'</font>)
00518         {
00519             <font class="keywordflow">if</font> ((<font class="keywordtype">char</font> *) getcwd(tmpwd, (size_t)PATH_MAX) == NULL)
00520             {
00521                 <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Unable to get the current working directory.\n"</font>);
00522                 sprintf(result, <font class="stringliteral">"%s %s"</font>, argZero, addedArg);
00523             }
00524             <font class="keywordflow">else</font>
00525                 sprintf(result, <font class="stringliteral">"%s/%s %s"</font>, <a class="code" href="ModuleImpl_8cpp.html#a0">stripcr</a>(tmpwd), argZero, addedArg);
00526         }
00527         <font class="keywordflow">else</font>                            <font class="comment">// Absolute path -- use it directly.</font>
00528         {
00529             sprintf(result, <font class="stringliteral">"%s %s"</font>, argZero, addedArg);
00530         }
00531 
00532         <a class="code" href="portableOS_8h.html#a2">TRACE</a>(<font class="stringliteral">"Startup command: "</font> &lt;&lt; result);
00533         <font class="keywordflow">return</font> result;
00534 
00535 <font class="preprocessor">#endif</font>
00536 <font class="preprocessor"></font>
00537         <font class="keywordflow">return</font> NULL ;
00538 }
</pre></div><hr>
<br>
<address>
<center>
<b>Systems Biology Workbench Development Group</b><br>
ERATO Kitano Systems Biology Project<br>
Control and Dynamical Systems, MC 107-81<br>
California Institute of Technology, Pasadena, CA 91125, USA<br>
<A HREF="mailto:sysbio-team@caltech.edu">sysbio-team@caltech.edu</A><br>
<A HREF="http://www.cds.caltech.edu/erato">http://www.cds.caltech.edu/erato</A><br><br>
<small>
Generated on Fri Nov 22 00:10:05 2002 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.2.14
</small>
</center>
</address>
</body>
</html>
