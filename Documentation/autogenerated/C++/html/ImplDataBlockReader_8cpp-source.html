<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ImplDataBlockReader.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ImplDataBlockReader.cpp</h1><a href="ImplDataBlockReader_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00013 <font class="comment">/*</font>
00014 <font class="comment">** Copyright 2001 California Institute of Technology and</font>
00015 <font class="comment">** Japan Science and Technology Corporation.</font>
00016 <font class="comment">** </font>
00017 <font class="comment">** This library is free software; you can redistribute it and/or modify it</font>
00018 <font class="comment">** under the terms of the GNU Lesser General Public License as published</font>
00019 <font class="comment">** by the Free Software Foundation; either version 2.1 of the License, or</font>
00020 <font class="comment">** any later version.</font>
00021 <font class="comment">** </font>
00022 <font class="comment">** This library is distributed in the hope that it will be useful, but</font>
00023 <font class="comment">** WITHOUT ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF</font>
00024 <font class="comment">** MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  The software and</font>
00025 <font class="comment">** documentation provided hereunder is on an "as is" basis, and the</font>
00026 <font class="comment">** California Institute of Technology and Japan Science and Technology</font>
00027 <font class="comment">** Corporation have no obligations to provide maintenance, support,</font>
00028 <font class="comment">** updates, enhancements or modifications.  In no event shall the</font>
00029 <font class="comment">** California Institute of Technology or the Japan Science and Technology</font>
00030 <font class="comment">** Corporation be liable to any party for direct, indirect, special,</font>
00031 <font class="comment">** incidental or consequential damages, including lost profits, arising</font>
00032 <font class="comment">** out of the use of this software and its documentation, even if the</font>
00033 <font class="comment">** California Institute of Technology and/or Japan Science and Technology</font>
00034 <font class="comment">** Corporation have been advised of the possibility of such damage.  See</font>
00035 <font class="comment">** the GNU Lesser General Public License for more details.</font>
00036 <font class="comment">** </font>
00037 <font class="comment">** You should have received a copy of the GNU Lesser General Public License</font>
00038 <font class="comment">** along with this library; if not, write to the Free Software Foundation,</font>
00039 <font class="comment">** Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.</font>
00040 <font class="comment">**</font>
00041 <font class="comment">** The original code contained here was initially developed by:</font>
00042 <font class="comment">**</font>
00043 <font class="comment">**     Andrew Finney, Herbert Sauro, Michael Hucka, Hamid Bolouri</font>
00044 <font class="comment">**     The Systems Biology Workbench Development Group</font>
00045 <font class="comment">**     ERATO Kitano Systems Biology Project</font>
00046 <font class="comment">**     Control and Dynamical Systems, MC 107-81</font>
00047 <font class="comment">**     California Institute of Technology</font>
00048 <font class="comment">**     Pasadena, CA, 91125, USA</font>
00049 <font class="comment">**</font>
00050 <font class="comment">**     http://www.cds.caltech.edu/erato</font>
00051 <font class="comment">**     mailto:sysbio-team@caltech.edu</font>
00052 <font class="comment">**</font>
00053 <font class="comment">** Contributor(s):</font>
00054 <font class="comment">**</font>
00055 <font class="comment">*/</font>
00056 
00057 <font class="keyword">static</font> <font class="keyword">const</font> <font class="keywordtype">char</font> rcsid[] = <font class="stringliteral">"$Id: ImplDataBlockReader_8cpp-source.html,v 1.1 2002/11/22 08:14:44 mhucka Exp $"</font>;
00058 
00059 <font class="preprocessor">#include "<a class="code" href="stdafx_8h.html">stdafx.h</a>"</font>
00060 <font class="preprocessor">#include "<a class="code" href="ImplDataBlockReader_8h.html">ImplDataBlockReader.h</a>"</font>
00061 <font class="preprocessor">#include "<a class="code" href="SBWOSSocket_8h.html">SBWOSSocket.h</a>"</font>
00062 
00063 <font class="keyword">using</font> <font class="keyword">namespace </font>SystemsBiologyWorkbench ;
00064 
00072 <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> <font class="keywordtype">void</font> sbwDataBlockReader::checkType(<a class="code" href="namespaceSystemsBiologyWorkbench.html#a7">DataBlockType</a> expectedType, <font class="keyword">const</font> <font class="keywordtype">char</font> *additional)
00073 {
00074         <font class="keywordflow">if</font> (end &gt;= length)
00075         {
00076             std::string message(<font class="stringliteral">"reached end of data when expecting "</font>);
00077             message += sbwDataBlockWriter::typeString(expectedType);
00078             message += <font class="stringliteral">" "</font>;
00079             message += additional;
00080 
00081             <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWTypeMismatchException(message);
00082         }
00083 
00084         <font class="keywordflow">if</font> (getNextType() != expectedType)
00085         {
00086                 std::string message(<font class="stringliteral">"encountered "</font>);
00087 
00088                 message += sbwDataBlockWriter::typeString(getNextType());
00089                 message += <font class="stringliteral">" required "</font>;
00090                 message += sbwDataBlockWriter::typeString(expectedType);
00091                 message += <font class="stringliteral">" "</font>;
00092                 message += additional;
00093 
00094                 <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWTypeMismatchException(message);
00095         }
00096 
00097         end++;
00098 }
00099 
<a name="l00103"></a><a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a5">00103</a> <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> sbwDataBlockReader::~sbwDataBlockReader()
00104 {
00105         <font class="keyword">delete</font>[] data;
00106 }
00107 
<a name="l00114"></a><a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a3">00114</a> <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> sbwDataBlockReader::sbwDataBlockReader(<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *x, <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> l, <font class="keywordtype">bool</font> makeCopy)
00115 : end(0), length(l)
00116 {
00117         <font class="keywordflow">if</font> (makeCopy)
00118         {
00119                 data = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>[l]; 
00120                 memcpy(data, x, l);
00121         }
00122         <font class="keywordflow">else</font>
00123                 data = x ;
00124 }
00125 
<a name="l00131"></a><a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a4">00131</a> <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> sbwDataBlockReader::sbwDataBlockReader(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *x, <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> l)
00132 : end(0), length(l)
00133 {
00134         data = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>[l]; 
00135         memcpy(data, x, l);
00136 }
00137 
00143 <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> <font class="keywordtype">void</font> sbwDataBlockReader::getWithoutType(DataBlockReader &amp;x)
00144 {
00145         <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a2">sbwDataBlockReader</a> *impl;
00146 
00147         <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(impl);
00148         DataBlockReader actual(impl);
00149 
00150         x = actual ;
00151 }
00152 
<a name="l00158"></a><a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a1">00158</a> <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> <font class="keywordtype">void</font> sbwDataBlockReader::dump()
00159 {
00160         printf(<font class="stringliteral">"\n"</font>);
00161 
00162         <font class="keywordtype">int</font> x = 0 ;
00163 
00164         <font class="keywordflow">while</font> (x != end)
00165         {
00166                 printf(<font class="stringliteral">"%d "</font>, data[x]);
00167                 x++;
00168         }
00169 
00170         printf(<font class="stringliteral">"&gt;"</font>);
00171 
00172         <font class="keywordflow">while</font> (x != length)
00173         {
00174                 printf(<font class="stringliteral">"%d "</font>, data[x]);
00175                 x++;
00176         }
00177 
00178         printf(<font class="stringliteral">"\n"</font>);
00179 }
00180 
00186 <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> <font class="keywordtype">void</font> sbwDataBlockReader::skipObjectWithoutType(<a class="code" href="namespaceSystemsBiologyWorkbench.html#a7">DataBlockType</a> type)
00187 {
00188         <font class="keywordflow">switch</font> (type)
00189         {
00190                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a28">IntegerType</a> :
00191                         {
00192                                 <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> a;
00193 
00194                                 <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(a) ;
00195                                 <font class="keywordflow">break</font> ;
00196                         }
00197                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a29">DoubleType</a> :
00198                         {
00199                                 <a class="code" href="namespaceSystemsBiologyWorkbench.html#a43">Double</a> a;
00200 
00201                                 <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(a) ;
00202                                 <font class="keywordflow">break</font> ;
00203                         }
00204                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a31">StringType</a> :
00205                         {
00206                                 std::string a;
00207 
00208                                 <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(a) ;
00209                                 <font class="keywordflow">break</font> ;
00210                         }
00211                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a32">ArrayType</a> :
00212                         skipArray();
00213                         <font class="keywordflow">break</font>;
00214                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a33">ListType</a> :
00215                         {
00216                                 DataBlockReader r;
00217 
00218                                 <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(r) ;
00219                                 <font class="keywordflow">break</font>;
00220                         }
00221                 
00222                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a30">BooleanType</a> :
00223                         {
00224                                 <font class="keywordtype">bool</font> z ;
00225 
00226                                 <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(z) ;
00227                                 <font class="keywordflow">break</font>;
00228                         }
00229 
00230                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a27">ByteType</a> :
00231                         {
00232                                 <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> x ;
00233 
00234                                 <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(x) ;
00235                                 <font class="keywordflow">break</font>;
00236                         }
00237 
00238                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a34">VoidType</a> :
00239                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a35">TerminateType</a> :
00240                 <font class="keywordflow">case</font> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a36">ErrorType</a> :
00241                     <font class="comment">/* These are only here to quiet some compilers. */</font>
00242                         {
00243                                 <font class="keywordflow">break</font>;
00244                         }
00245         }
00246 }
00247 
00252 <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> <font class="keywordtype">void</font> sbwDataBlockReader::skipArray()
00253 {
00254         <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> dimensions ;
00255         <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> type ;
00256         <font class="keywordtype">int</font> dimension = 0 ;
00257         <font class="keywordtype">int</font> size = 1;
00258         <font class="keywordtype">int</font> item = 0;
00259 
00260         <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(type);
00261         <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(dimensions);
00262 
00263         <font class="keywordflow">while</font> (dimension != dimensions)
00264         {
00265                 <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> dimSize ;
00266 
00267                 <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(dimSize);
00268                 size *= dimSize ;
00269                 dimension++;
00270         }
00271 
00272         <font class="keywordflow">while</font> (item != size)
00273         {
00274                 skipObjectWithoutType((<a class="code" href="namespaceSystemsBiologyWorkbench.html#a7">DataBlockType</a>)type);
00275                 item++;
00276         }
00277 }
00278 
<a name="l00286"></a><a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#d0">00286</a> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> sbwDataBlockReader::readInteger(SBWOSSocket *sock)
00287 {
00288         <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> result ;
00289         <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> *buffer = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>[4];
00290         <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a2">sbwDataBlockReader</a> reader(buffer, 4, <font class="keyword">false</font>);  <font class="comment">// this free's buffer on its destruction</font>
00291         
00292         sock-&gt;receive(buffer, 4);
00293         reader.getWithoutType(result);
00294         
00295         <font class="keywordflow">return</font> result ;
00296 }
00297 
<a name="l00302"></a><a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a8">00302</a> <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a7">DataBlockType</a> sbwDataBlockReader::getNextArrayType()
00303 {
00304         <font class="keywordflow">if</font> (<a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a7">getNextType</a>() != <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a32">ArrayType</a>)
00305                 <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWTypeMismatchException(<font class="stringliteral">"next type is not an array"</font>);
00306 
00307         <font class="keywordflow">if</font> (end + 1 &gt; length)
00308                 <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWTypeMismatchException(<font class="stringliteral">"reached end of data"</font>);
00309 
00310         <font class="keywordtype">int</font> x = (char)data[end + 1];
00311         <font class="keywordflow">return</font> (DataBlockType)x ;
00312 }
00313 
<a name="l00319"></a><a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a9">00319</a> <a class="code" href="sbwdefs_8h.html#a0">SBW_API</a> <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> sbwDataBlockReader::getNextArrayDimensions()
00320 {
00321         <font class="keywordflow">if</font> (<a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a7">getNextType</a>() != <a class="code" href="namespaceSystemsBiologyWorkbench.html#a60a32">ArrayType</a>)
00322                 <font class="keywordflow">throw</font> <font class="keyword">new</font> SBWTypeMismatchException(<font class="stringliteral">"next type is not an array"</font>);
00323 
00324         <font class="comment">// move end up to array dimensions just for this function</font>
00325         end += 2;
00326 
00327         <a class="code" href="namespaceSystemsBiologyWorkbench.html#a42">Integer</a> result ;
00328 
00329         <a class="code" href="structSystemsBiologyWorkbench_1_1sbwDataBlockReader.html#a16">getWithoutType</a>(result);
00330         end -= 6 ; <font class="comment">// 1 byte for Array Type, 1 byte for Inner Type and 4 bytes for dimensions</font>
00331 
00332         <font class="keywordflow">return</font> result ;
00333 }
</pre></div><hr>
<br>
<address>
<center>
<b>Systems Biology Workbench Development Group</b><br>
ERATO Kitano Systems Biology Project<br>
Control and Dynamical Systems, MC 107-81<br>
California Institute of Technology, Pasadena, CA 91125, USA<br>
<A HREF="mailto:sysbio-team@caltech.edu">sysbio-team@caltech.edu</A><br>
<A HREF="http://www.cds.caltech.edu/erato">http://www.cds.caltech.edu/erato</A><br><br>
<small>
Generated on Fri Nov 22 00:10:04 2002 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.2.14
</small>
</center>
</address>
</body>
</html>
